pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- cute pong main
-- by wahtzy ðŸ˜

entities = {}

function _init()
	paddle1 = make_paddle(10,58,0)
	add(entities, paddle1)
	ball = make_ball(64,64)
	add(entities, ball)
end

function _update60()
	foreach(entities, update_entity)
end

function _draw()
	rectfill(0,0,127,127,0)
	map(0,0,0,0,16,16)
	foreach(entities, draw_entity)
end
-->8
-- entity
-- kinds:
-- 0 = nothing
-- 1 = paddle
-- 2 = ai paddle
-- 3 = ball
-- 4 = powerup

function make_entity(x,y,k)
	local a = {}
	a.h = 8
	a.w = 8
	a.speed = 0
	a.hsp = 0
	a.vsp = 0
	a.x = x a.y = y
	a.k = k
	a.spri = 0
	a.sprx = 1
	a.spry = 1
	a.sprn = 1
 a.bounce = 0
 a.collides = true
	return a
end

function update_entity(en)
	if (en.k == 0) then
	
	elseif (en.k == 1) then
 	update_paddle(en)
	elseif (en.k == 2) then
	
	elseif (en.k == 3) then
  	update_ball(en)
	elseif (en.k == 4) then
	
	end
end

function edge_collision(en)
 if (en.x + en.hsp < 0) then
 	while (en.x > 0) do
 		en.x -= 1
 	end
 	en.hsp *= -en.bounce
 end
 
 if (en.x + en.w + en.hsp > 127) then
 	while (en.x + en.w < 127) do
 		en.x += 1
 	end
 	en.hsp *= -en.bounce
 end
 
 if (en.y + en.vsp < 0) then
 	while (en.y > 0) do
 		en.y -= 1
 	end
 	en.vsp *= -en.bounce
 end
 
 if (en.y + en.h + en.vsp > 127) then
 	while (en.y + en.h < 127) do
 		en.y += 1
 	end
 	en.vsp *= -en.bounce
 end
end

function sign(val)
	if val < 0 then
		return -1
	else
		return 1
	end
end

function collision_check(e,x,y)
	for e2 in all(entities) do
		if e != e2 and e2.collides then
			if x < e2.x + e2.w and
				x + e.w > e2.x and
				y < e2.y + e2.h and
				y + e.h > e2.y
				then
				return true
			end
		end
	end
	return false
end

function collision(e)
	edge_collision(e)
	if (collision_check(e, e.x + e.hsp, e.y)) then
		while not collision_check(e, e.x + sign(e.hsp), e.y) do
			e.x += sign(e.hsp)
		end
		e.hsp *= -e.bounce
	end

	if (collision_check(e, e.x, e.y + e.vsp)) then
		while not collision_check(e, e.x, e.y + sign(e.vsp)) do
			e.y += sign(e.vsp)
		end
		e.vsp *= -e.bounce
	end
end

function draw_entity(en)
    spr(en.spri, en.x, en.y, en.sprx, en.spry)
end

-->8
-- paddle

function make_paddle(x,y,p)
	local pl = make_entity(x,y,1)
 pl.p = p
 pl.h = 22
 pl.w = 6
 pl.speed = 2
 pl.spri = 16
 pl.sprx = 1
 pl.spry = 3
 pl.sprn = 1
 return pl
end

function update_paddle(pl)
	up = 0 down = 0
 if (btn(2, pl.p)) up = 1
 if (btn(3, pl.p)) down = 1
 mov = -up + down
 pl.vsp = mov * pl.speed
 
 edge_collision(pl)
    
 pl.y += pl.vsp
end

-->8
-- ball

function make_ball(x,y)
	local bl = make_entity(x,y,3)

	bl.w = 8
	bl.h = 8
	bl.speed = 4
    
 bl.hsp = rnd(bl.speed * 2) - bl.speed
 bl.vsp = rnd(bl.speed * 2) - bl.speed

 bl.spri = 1
 bl.bounce = 1
 bl.collides = false
    
	return bl
end

function update_ball(bl)
 
	collision(bl)
	bl.x += bl.hsp
 bl.y += bl.vsp
    
end

function draw_ball(bl)
	spr(1,bl.x,bl.y)
	pset(bl.x - 1, bl.y -1, 1)
	pset(bl.x - 1, bl.y, 1)
	pset(bl.x + 1, bl.y -1, 1)
	pset(bl.x + 1, bl.y, 1)
end


__gfx__
0000000001dffd10000000000000000000000000d111111d00000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001ff77ff10000000000000000000000001dd1111100000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700df7777fd0000000000000000000000001d111dd100000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000f777777f0000000000000000000000001d111dd100000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000f777777f0000000000000000000000001d1d111100000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700df7777fd0000000000000000000000001d1111d100000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001ff77ff10000000000000000000000001dddddd100000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001dffd10000000000000000000000000d111111d00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06777760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06777760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000300002c45010450234501c45036450264502a4501f450104502845021450284503f4503a4502345005450114503f4502345024450074503d45011450354501645010450194501b4501c450194500245003450
001000001a450000001a45000000000001a45000000000001a45020450000002a450000001b450000001e4500000014450000001a450000001a4500000000000000001b450000001a45000000000001a45000000
00100000034500345003450014500345003450034500345001450014500345008450084500845003450014500345008450084500a4500a4500345003450034500a4500a450034500345003450084500145003450
001000000c4500e45010450114500c4500e4500e4500e4500c4500c4500e4501045010450104500e450174501545017450154500c450134500e450134501345010450154500e4501545010450134500e45015450
__music__
00 01020344

